<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metro Numbers Quiz - English Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap');

        body {
            font-family: 'Roboto', sans-serif;
            overflow: hidden;
            background-color: #0a0a0a;
            user-select: none;
            margin: 0;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: #000;
        }

        /* WORLD CONTAINER (1920x1080 virtual space) */
        #world {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 1920px;
            height: 1080px;
            transform-origin: center center;
        }

        #bg-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
            filter: brightness(0.5) contrast(1.1);
        }

        /* Adjusted position to -100px as requested */
        #display-board-container {
            position: absolute;
            top: -100px; 
            left: 50%;
            transform: translateX(-50%);
            width: 900px;
            height: 400px;
            z-index: 15;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #board-img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 15px 30px rgba(0,0,0,0.9));
        }

        #board-number {
            position: relative;
            z-index: 2;
            color: #facc15; 
            font-family: 'Roboto', sans-serif; /* Changed to Roboto for better readability */
            font-weight: 900;
            font-size: 3.8rem;
            text-shadow: 0 0 15px rgba(250, 204, 21, 0.8), 0 0 5px rgba(0,0,0,0.5); 
            background: transparent;
            padding: 0;
            /* Raised even higher (reduced margin-top) */
            margin-top: 15px; 
            letter-spacing: 4px;
        }

        /* Train Container */
        #train-wrapper {
            position: absolute;
            width: 1100px; 
            height: auto;
            z-index: 10;
            transition: left 3.5s cubic-bezier(0.25, 1, 0.5, 1);
            filter: drop-shadow(20px 20px 30px rgba(0,0,0,0.9));
        }
        
        .relative-train {
            position: relative;
            width: 100%;
        }

        .train-image {
            width: 100%;
            height: auto;
            display: block;
        }

        /* UI Layer */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100; 
            pointer-events: none; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Industrial Style Quiz Panel */
        #quiz-panel {
            pointer-events: auto;
            background: rgba(15, 15, 20, 0.9); 
            backdrop-filter: blur(15px);
            padding: 2.5rem;
            border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.9);
            text-align: center;
            max-width: 90%;
            width: 650px;
            opacity: 0;
            transform: translateY(50px) scale(0.9);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
            gap: 25px;
            /* Raised another 150px higher (110px - 150px = -40px) */
            margin-top: -40px; 
            border: 2px solid rgba(250, 204, 21, 0.4); 
        }

        #quiz-panel.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .quiz-title {
            font-size: 1.8rem;
            color: #facc15;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .quiz-subtitle {
            color: #a0aec0;
            font-size: 1.1rem;
            margin-bottom: -10px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        @media (min-width: 640px) {
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Option buttons as glowing station signs */
        .btn-option {
            background: #12121a;
            border: 1px solid #4a5568;
            padding: 18px;
            border-radius: 12px;
            font-size: 1.3rem;
            font-weight: 700;
            color: #facc15;
            transition: all 0.25s;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            font-family: 'Roboto', sans-serif;
            text-transform: capitalize;
        }

        .btn-option:hover:not(.disabled) {
            background: #232331;
            border-color: #facc15;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(250, 204, 21, 0.2);
        }

        .btn-option.correct {
            background: #065f46 !important;
            color: white !important;
            border-color: #10b981 !important;
            animation: bounce 0.5s;
        }

        .btn-option.wrong {
            background: #7f1d1d !important;
            color: #fecaca !important;
            border-color: #ef4444 !important;
            animation: shake 0.4s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .btn-start {
            pointer-events: auto;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: #000;
            font-size: 1.8rem;
            padding: 20px 60px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-weight: 900;
            box-shadow: 0 10px 25px rgba(217, 119, 6, 0.4);
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-start:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 35px rgba(217, 119, 6, 0.6);
        }

        .progress-container {
            position: absolute;
            top: 25px;
            left: 25px;
            z-index: 150;
            background: rgba(15, 15, 20, 0.9);
            padding: 12px 25px;
            border-radius: 12px;
            color: #facc15;
            font-size: 1.1rem;
            font-family: 'Roboto', sans-serif;
            border: 1px solid rgba(250, 204, 21, 0.3);
            backdrop-filter: blur(8px);
        }

        .results-wrapper {
            background: rgba(10, 10, 15, 0.9);
            backdrop-filter: blur(15px);
            border-radius: 24px;
            padding: 40px;
            border: 2px solid #facc15;
            max-width: 90%;
            width: 700px;
        }
        
        .score-display {
            font-size: 5rem;
            font-weight: 900;
            color: #facc15;
            margin-bottom: 20px;
            font-family: 'Roboto', sans-serif;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="world">
        <!-- Station Background -->
        <img id="bg-image" src="https://i.postimg.cc/JzRTSPSR/Gemini_Generated_Image_nqge34nqge34nqge.png" alt="Metro Station">

        <!-- Display Board -->
        <div id="display-board-container">
            <img id="board-img" src="https://i.postimg.cc/Jh2K8TwN/Gemini_Generated_Image_t1qlc9t1qlc9t1ql.png" alt="Station Board" onerror="this.style.backgroundColor='#111'; this.src='data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'">
            <div id="board-number">--</div>
        </div>

        <!-- Train -->
        <div id="train-wrapper">
            <div class="relative-train">
                <img id="train-img" class="train-image" src="" alt="Train">
            </div>
        </div>
    </div>

    <!-- UI Overlay Layer -->
    <div id="ui-layer">
        
        <div class="progress-container">
            SCORE: <span id="current-score" class="text-white">0</span> | TRAINS: <span id="current-count" class="text-white">0</span>/<span id="total-count" class="text-white">0</span>
        </div>

        <!-- Start Screen - Pushed down slightly -->
        <div id="start-screen" class="flex flex-col items-center" style="margin-top: 150px;">
            <h1 class="text-6xl md:text-8xl text-yellow-400 font-black mb-8 text-center tracking-tighter" style="text-shadow: 6px 6px 0px #000;">METRO QUIZ</h1>
            <button class="btn-start" onclick="startGame()">
                <i class="fas fa-train mr-3"></i> Start Shift
            </button>
        </div>

        <!-- Quiz Panel -->
        <div id="quiz-panel">
            <div class="flex flex-col">
                <h2 class="quiz-title">Incoming Train</h2>
                <p class="quiz-subtitle">Select the correct number from the board:</p>
            </div>
            <div id="options-grid" class="options-grid">
                <!-- Buttons injected via JS -->
            </div>
        </div>

        <!-- End Screen -->
        <div id="end-screen" class="hidden flex flex-col items-center w-full z-50">
            <h2 class="text-4xl text-white font-black mb-4 uppercase tracking-widest">Shift Completed</h2>
            <div class="score-display">
                <span id="final-score">0</span>%
            </div>
            
            <div class="results-wrapper text-center">
                <div class="flex justify-center">
                     <button class="btn-start" onclick="location.reload()">
                        <i class="fas fa-redo mr-2"></i> Restart
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- Responsive World Scaling ---
    const worldEl = document.getElementById('world');
    const WORLD_W = 1920;
    const WORLD_H = 1080;

    function resizeWorld() {
        const winW = window.innerWidth;
        const winH = window.innerHeight;
        const scale = Math.max(winW / WORLD_W, winH / WORLD_H);
        worldEl.style.transform = `translate(-50%, -50%) scale(${scale})`;
    }

    window.addEventListener('resize', resizeWorld);
    resizeWorld();

    // --- Configuration ---
    const gameNumbers = [100, 32, 29, 47, 51, 68, 93, 77, 84, 38];
    const trainImages = [
        "https://i.postimg.cc/qvpmWjWq/Gemini_Generated_Image_del838del838del8.png",
        "https://i.postimg.cc/RZvP2X20/Gemini_Generated_Image_hhla1khhla1khhla.png",
        "https://i.postimg.cc/Dw7CRBRZ/Gemini_Generated_Image_m6kcm6kcm6kcm6kc.png"
    ];

    let queue = [];
    let currentIndex = 0;
    let score = 0;
    let isTransitioning = false;
    let currentTrainDirection = 'LR'; 
    let lastDirectionLR = false; 

    const trainWrapper = document.getElementById('train-wrapper');
    const trainImg = document.getElementById('train-img');
    const startScreen = document.getElementById('start-screen');
    const quizPanel = document.getElementById('quiz-panel');
    const optionsGrid = document.getElementById('options-grid');
    const endScreen = document.getElementById('end-screen');
    const boardNumberEl = document.getElementById('board-number');
    
    const currentCountEl = document.getElementById('current-count');
    const totalCountEl = document.getElementById('total-count');
    const currentScoreEl = document.getElementById('current-score');
    const finalScoreEl = document.getElementById('final-score');

    const ONES = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine'];
    const TEENS = ['ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];
    const TENS = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];

    function numberToEnglish(n) {
        if (n === 100) return "one hundred";
        if (n < 10) return ONES[n];
        if (n < 20) return TEENS[n - 10];
        const digitOne = n % 10;
        const digitTen = Math.floor(n / 10);
        return TENS[digitTen] + (digitOne !== 0 ? '-' + ONES[digitOne] : '');
    }

    function init() {
        trainImages.forEach(src => { const img = new Image(); img.src = src; });
        queue = [...gameNumbers];
        shuffleArray(queue);
        totalCountEl.textContent = queue.length;
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function startGame() {
        startScreen.classList.add('hidden');
        spawnTrain();
    }

    function spawnTrain() {
        if (currentIndex >= queue.length) {
            finishGame();
            return;
        }

        const number = queue[currentIndex];
        currentCountEl.textContent = currentIndex + 1;
        
        const randomTrain = trainImages[Math.floor(Math.random() * trainImages.length)];
        trainImg.src = randomTrain;
        boardNumberEl.textContent = number;

        const isLeftToRight = !lastDirectionLR;
        lastDirectionLR = isLeftToRight;
        currentTrainDirection = isLeftToRight ? 'LR' : 'RL';

        const isStandardTrack = Math.random() > 0.5;

        if (isStandardTrack) {
            trainWrapper.style.bottom = '104px'; 
            trainWrapper.style.zIndex = '11';
            trainWrapper.style.transform = isLeftToRight ? 'scale(1.0) scaleX(-1)' : 'scale(1.0) scaleX(1)';
        } else {
            trainWrapper.style.bottom = '14px'; 
            trainWrapper.style.zIndex = '12';
            trainWrapper.style.transform = isLeftToRight ? 'scale(1.05) scaleX(-1)' : 'scale(1.05) scaleX(1)';
        }

        trainWrapper.style.transition = 'none';
        
        if (isLeftToRight) {
            trainWrapper.style.left = '-1200px'; 
        } else {
            trainWrapper.style.left = '2000px'; 
        }
        
        void trainWrapper.offsetWidth; 

        trainWrapper.style.transition = 'left 3.5s cubic-bezier(0.25, 1, 0.5, 1)';
        const centerPos = `410px`; 

        quizPanel.classList.remove('visible');

        setTimeout(() => {
            trainWrapper.style.left = centerPos;
            setTimeout(() => { showQuiz(number); }, 4000); 
        }, 100);
    }

    function showQuiz(correctNumber) {
        let options = [correctNumber];
        while (options.length < 4) {
            let r = Math.floor(Math.random() * 80) + 20; 
            if(Math.random() > 0.95) r = 100;
            if (!options.includes(r)) options.push(r);
        }
        shuffleArray(options);

        optionsGrid.innerHTML = '';
        options.forEach(num => {
            const btn = document.createElement('button');
            btn.className = 'btn-option';
            const text = numberToEnglish(num);
            btn.textContent = text;
            btn.onclick = () => handleAnswer(btn, num, correctNumber);
            optionsGrid.appendChild(btn);
        });

        quizPanel.classList.add('visible');
    }

    function handleAnswer(btn, selectedNum, correctNum) {
        if (isTransitioning || btn.classList.contains('disabled')) return;

        const allBtns = document.querySelectorAll('.btn-option');

        if (selectedNum === correctNum) {
            btn.classList.add('correct');
            score++;
            currentScoreEl.textContent = score * 10; 
            isTransitioning = true;
            allBtns.forEach(b => b.classList.add('disabled'));
            playTone('correct');

            setTimeout(() => {
                quizPanel.classList.remove('visible');
                departTrain();
            }, 1000);
        } else {
            btn.classList.add('wrong');
            btn.classList.add('disabled'); 
            playTone('wrong');
        }
    }

    function departTrain() {
        trainWrapper.style.transition = 'left 2.0s ease-in';
        if (currentTrainDirection === 'LR') {
            trainWrapper.style.left = '2000px'; 
        } else {
            trainWrapper.style.left = '-1200px';
        }
        
        currentIndex++;
        isTransitioning = false;
        
        setTimeout(() => { spawnTrain(); }, 2100);
    }

    function finishGame() {
        quizPanel.classList.remove('visible');
        boardNumberEl.textContent = "--";
        endScreen.classList.remove('hidden');
        endScreen.classList.add('flex');
        finalScoreEl.textContent = Math.round((score / gameNumbers.length) * 100); 
    }

    function playTone(type) {
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        if (!AudioContext) return;
        const ctx = new AudioContext();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        
        if (type === 'correct') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(500, ctx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1000, ctx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
            osc.start();
            osc.stop(ctx.currentTime + 0.5);
        } else {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, ctx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, ctx.currentTime + 0.3);
            gain.gain.setValueAtTime(0.1, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
            osc.start();
            osc.stop(ctx.currentTime + 0.3);
        }
    }

    init();
</script>
</body>
</html>